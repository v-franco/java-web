
<script language=javascript>

	var xhr;
	
    function obtenerDatos()
	{
		var datos="";
		
		var titulo = document.getElementById("titulo").value;
		var autor  = document.getElementById("autor").value;
		var edit   = document.getElementById("editorial").value;
		
		if(titulo == "" || autor == "" || edit == "")
			datos = "VACIO";
		else
			datos = "titulo="+titulo+"&autor="+autor+"&editorial="+edit;
		
		return datos;
	}

    function capturarDatos()
	{
		var datos="";
		var urlString="";
		
		// 1. Obtener los datos de los textfields del form html
		datos = obtenerDatos();
		
		// 2. Checar los datos del usuario
		if(datos == "VACIO")
		{
			alert("Algun campo esta vacio...");
			document.getElementById("transaccion").innerHTML ="Algun campo esta vacio...";
		}
		else
		{
			//alert(datos);
			//document.getElementById("transaccion").innerHTML = datos;
			
			// 2.1 Preparar el URL String
			urlString = "../librojsp/Library.jsp?bCapture=capturar&"+datos;
			
			// 2.2 Crear el objeto XMLHttpRequest
			xhr = new XMLHttpRequest();
			
			// 2.3 Establecer la conexion con el Server Http
			establecerConexionAjax(urlString);
		}	
	}

    function establecerConexionAjax(urlString)
	{
		xhr.open("get",urlString,true);
		xhr.onreadystatechange=obtenerResultadoAjax;
		xhr.send(null);
	}

    function obtenerResultadoAjax()
	{	
		if(xhr.readyState == 4)
		{
			document.getElementById("transaccion").innerHTML = xhr.responseText;
		}
	}
	
	function obtenerResultadoJson()
	{	
		var libros;
		var datos="";
		
		if(xhr.readyState == 4)
		{
			//document.getElementById("transaccion").innerHTML = xhr.responseText;
			
			//clientes = eval("("+xhr.responseText+")");
			clientes = JSON.parse(xhr.responseText);
			
			//document.getElementById("transaccion").innerHTML = xhr.responseText;
			//document.getElementById("transaccion").innerHTML = clientes;
			
			datos = "<table border=1>";
			for(i=0; i<clientes.length; i++)
			{
				//datos = datos + clientes[i].nocta+"   "+clientes[i].nombre+"   "+clientes[i].nombre+"   "+clientes[i].saldo+"<br/>";
				datos = datos +"<tr><td>"+clientes[i].titulo+"</td><td>"+clientes[i].autor+"</td><td>"+clientes[i].editorial+"</td></tr>";
			}
			datos = datos + "</table>";
			
			document.getElementById("transaccion").innerHTML = datos;
			
		}
	}

    
	
	function establecerConexionConsultar(urlString)
	{
		xhr.open("get",urlString,true);
		//xhr.onreadystatechange=obtenerResultado;
		xhr.onreadystatechange=obtenerResultadoJson;
		xhr.send(null);
	}
	
	function obtenerResultado()
	{	
		if(xhr.readyState == 4)
		{
			document.getElementById("transaccion").innerHTML = xhr.responseText;
		}
	}
	
	function establecerConexion(urlString)
	{
		xhr.open("get",urlString,true);
		xhr.onreadystatechange=obtenerResultado;
		xhr.send(null);
	}
	
	function consultarTipo()
	{
		// 1. Obtener el valor del Tipo de Cuenta del TextField correspondiente
		var edit = document.getElementById("editorial").value;

        if(edit == "")
		{
			alert("Teclear una Editorial valida...");
		}
        else{
            // 2. Preparar el URL String
            var urlString = "../librojsp/Library.jsp?bConsultEditJson=consultar&editorial="+edit;
            
            // 3. Crear el objeto de conexion
            xhr = new XMLHttpRequest();
            
            // 4. Establecer conexion y ejecutar transaccion
            establecerConexion(urlString);
        }
		
	}

    function consultarTipoAjax()
	{
		// 1. Obtener el valor del Tipo de Cuenta del TextField correspondiente
		var edit = document.getElementById("editorial").value;

        if(edit == "")
		{
			alert("Teclear una Editorial valida...");
		}
        else{
            // 2. Preparar el URL String
            var urlString = "../librojsp/Library.jsp?bConsultEdit=consultar&editorial="+edit;
            
            // 3. Crear el objeto de conexion
            xhr = new XMLHttpRequest();
            
            // 4. Establecer conexion y ejecutar transaccion
            establecerConexion(urlString);
        }
		
	}

    function consultarTit()
	{
		// 1. Obtener el valor del Tipo de Cuenta del TextField correspondiente
		var tit = document.getElementById("titulo").value;

        if(tit == "")
		{
			alert("Teclear un titulo valido...");
		}
        else{
            // 2. Preparar el URL String
            var urlString = "../librojsp/Library.jsp?bConsultTitleJson=consultar&titulo="+tit;
            
            // 3. Crear el objeto de conexion
            xhr = new XMLHttpRequest();
            
            // 4. Establecer conexion y ejecutar transaccion
            establecerConexion(urlString);
        }
		
	}

    function consultarTitAjax()
	{
		// 1. Obtener el valor del Tipo de Cuenta del TextField correspondiente
		var tit = document.getElementById("titulo").value;

        if(tit == "")
		{
			alert("Teclear un titulo valido...");
		}
        else{
            // 2. Preparar el URL String
            var urlString = "../librojsp/Library.jsp?bConsultTitle=consultar&titulo="+tit;
            
            // 3. Crear el objeto de conexion
            xhr = new XMLHttpRequest();
            
            // 4. Establecer conexion y ejecutar transaccion
            establecerConexion(urlString);
        }
		
	}

    function establecerConexionJson(urlString)
	{
		xhr.open("get",urlString,true);
		//xhr.onreadystatechange=obtenerResultadoJson;
		xhr.onreadystatechange=obtenerResultadoJson2;
		xhr.send(null);
	}   

    function obtenerResultadoJson2()
	{	
		var libros;
		var datos="";
		var strHtmlImg;
		var strRefTit;
		var strRefImg;
		var imagen="";
		
		if(xhr.readyState == 4)
		{
			//document.getElementById("transaccion").innerHTML = xhr.responseText;
			
			//libros = eval("("+xhr.responseText+")");
			libros = JSON.parse(xhr.responseText);
			
			//document.getElementById("transaccion").innerHTML = xhr.responseText;
			//document.getElementById("transaccion").innerHTML = clientes;
			
			datos = "<table border=1>";
			for(i=0; i<libros.length; i++)
			{
				imagen = libros[i].titulo + ".jpg"
				strHtmlImg = "<img src='../librojsp/images/"+imagen+"' width=100 heigth=80>";
 				strRefTit  = "<a href='../librojsp/Libro.jsp?bEditar=editar&autor="+libros[i].autor+"&editorial="+libros[i].editorial+"&titulo="+libros[i].titulo+"'>"+libros[i].titulo+"</a>";
 				strRefImg  = "<a href='../librojsp/Libro.jsp?bEditar=editar&autor="+libros[i].autor+"&editorial="+libros[i].editorial+"&titulo="+libros[i].titulo+"'>"+strHtmlImg+"</a>";

        		//datos = datos +"<tr><td>"+libros[i].titulo+"</td><td>"+libros[i].autor+"</td><td>"+libros[i].editorial+"</td></tr>";
        		//datos = datos +"<tr><td>"+libros[i].titulo+"</td><td>"+libros[i].autor+"</td><td>"+libros[i].editorial+"</td><td>"+strHtmlImg+"</td></tr>";
        		//datos = datos +"<tr><td>"+libros[i].titulo+"</td><td>"+libros[i].autor+"</td><td>"+libros[i].editorial+"</td><td>"+strRefImg+"</td></tr>";
        		datos = datos +"<tr><td>"+strRefTit+"</td><td>"+libros[i].autor+"</td><td>"+libros[i].editorial+"</td><td>"+strRefImg+"</td></tr>";
			}
			datos = datos + "</table>";
			
			document.getElementById("transaccion").innerHTML = datos;
			
		}
	}
	
	function consultar()
	{
		
		// 1. Preparar el URL String
		var urlString = "../librojsp/Library.jsp?bConsultJson=consultar";
		
		// 1. Crear el objeto de conexion
		xhr = new XMLHttpRequest();
		
		// 3. Establecer conexion y ejecutar transaccion
		establecerConexionConsultar(urlString);
	}

    function consultarAjax()
	{
		
		// 1. Preparar el URL String
		var urlString = "../librojsp/Library.jsp?bConsult=consultar";
		
		// 1. Crear el objeto de conexion
		xhr = new XMLHttpRequest();
		
		// 3. Establecer conexion y ejecutar transaccion
		establecerConexion(urlString);
	}

</script>

<html>
    <head>
        <meta http-equiv=”Content-Type” content=”text/html charset="UTF-8" />
        <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.0-beta3/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-eOJMYsd53ii+scO/bJGFsiCZc+5NDVN2yr8+0RDqr0Ql0h+rP48ckxlpbzKgwra6" crossorigin="anonymous">
        <link rel="stylesheet" type="text/css" href="styles.css">
        <title>JSP Bank</title>
        <style>
            body {background-color: #565d6d;}

        </style>
    </head>
	<body><center>
		
		<!--<form action='../cgi-bin/ClienteController.py' method='get'>-->
		<!--<form action='../banco/banco' method='get'>-->
            <br>
            <h2 class="title">JSP Library</h2>
		    <form action='../librojsp/Library.jsp' method='get'>
                <table style="width: 50%">
                    <tr>   
                        <td><p class="texto16 text-end"> TITULO: </p></td>
                        <td align="center"><input type='text' name='titulo' class="field" id='titulo'  value=""></td><br/>
                    </tr>
                    <tr>
                        <td><p class="texto16 text-end"> AUTOR: </p></td>
                        <td align="center"><input type='text' name='autor' class="field" id='autor' value=''></td><br/>
                    </tr>
                    <tr>   
                        <td><p class="texto16 text-end"> EDITORIAL: </p></td>
                        <td align="center"><input type='text' name='editorial' class="field"  id='editorial'   value=""></td><br/>
                    </tr>
                </table>
                <table>
                    <tr>
                        <td colspan="2" align="center">
                            <br><br><br><br>
                            <input type='submit' name='bCapture' value='Capturar Datos' class="button">
                            <input type='submit' name='bConsult' value='Consultar Libros' class="button">
                            <input type='submit' name='bConsultEdit' value='Consultar Editorial' class="button">
                            <input type='submit' name='bConsultTitle' value='Consultar Titulo' class="button">
                            
                        </td>
                    </tr>
                    <tr>
                        <td colspan="2" align="center">
                            <input type='button' name='bConsultarAjax' id="bConsultarAjax" value='Consultar general AJAX' class="buttonJson" onclick='consultarAjax()'>
                            <input type='button' name='bConsultarEditAjax' id="bConsultarEditAjax" value='Consultar editorial AJAX' class="buttonJson" onclick='consultarTipoAjax()'>
                            <input type='button' name='bConsultarTitAjax' id="bConsultarTitAjax" value='Consultar titulo AJAX' class="buttonJson" onclick='consultarTitAjax()'>
                        </td>
                    </tr>     
                    <tr>
                        <td colspan="2" align="center">
                            <input type='button' name='bConsultarJson' id="bConsultarJson" value='Consultar general JSON' class="buttonJson" onclick='consultar()'>
                            <input type='button' name='bConsultarEditJson' id="bConsultarEditJson" value='Consultar editorial JSON' class="buttonJson" onclick='consultarTipo()'>
                            <input type='button' name='bConsultarTitJson' id="bConsultarTitJson" value='Consultar titulo JSON' class="buttonJson" onclick='consultarTit()'>
                        </td>
                    </tr>               
                </table>                 
            </form>
        
		<br/><br/>
        <p class="texto16"> Transacción: </p><div id='transaccion'></div>
    </center></body>
</html>